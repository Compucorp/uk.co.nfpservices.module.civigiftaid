<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: A Pages: 1 -->
<svg width="407pt" height="1138pt"
 viewBox="0.00 0.00 407.00 1138.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 1134)">
<title>A</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-1134 403,-1134 403,4 -4,4"/>
<!-- contribCreate -->
<g id="node1" class="node">
<title>contribCreate</title>
<polygon fill="none" stroke="#000000" points="283,-1130 140,-1130 140,-1094 283,-1094 283,-1130"/>
<text text-anchor="middle" x="211.5" y="-1108.3" font-family="Lato" font-size="14.00" fill="#000000">Contribution.create</text>
</g>
<!-- BAOsave -->
<g id="node2" class="node">
<title>BAOsave</title>
<polygon fill="none" stroke="#000000" points="251.5,-1057 171.5,-1057 171.5,-1021 251.5,-1021 251.5,-1057"/>
<text text-anchor="middle" x="211.5" y="-1035.3" font-family="Lato" font-size="14.00" fill="#000000">BAO Save</text>
</g>
<!-- contribCreate&#45;&gt;BAOsave -->
<g id="edge1" class="edge">
<title>contribCreate&#45;&gt;BAOsave</title>
<path fill="none" stroke="#000000" d="M211.5,-1093.9551C211.5,-1085.8828 211.5,-1076.1764 211.5,-1067.1817"/>
<polygon fill="#000000" stroke="#000000" points="215.0001,-1067.0903 211.5,-1057.0904 208.0001,-1067.0904 215.0001,-1067.0903"/>
</g>
<!-- hookPost -->
<g id="node3" class="node">
<title>hookPost</title>
<polygon fill="none" stroke="#000000" points="392.5,-984 30.5,-984 30.5,-946 392.5,-946 392.5,-984"/>
<text text-anchor="middle" x="211.5" y="-968.8" font-family="Lato" font-size="14.00" fill="#000000">hook_post:</text>
<text text-anchor="middle" x="211.5" y="-953.8" font-family="Lato" font-size="14.00" fill="#000000">CRM_Civigiftaid_SetContributionGiftAidEligibility::run</text>
</g>
<!-- BAOsave&#45;&gt;hookPost -->
<g id="edge2" class="edge">
<title>BAOsave&#45;&gt;hookPost</title>
<path fill="none" stroke="#000000" d="M211.5,-1020.7079C211.5,-1012.7096 211.5,-1003.1287 211.5,-994.1859"/>
<polygon fill="#000000" stroke="#000000" points="215.0001,-994.1139 211.5,-984.114 208.0001,-994.114 215.0001,-994.1139"/>
</g>
<!-- trans -->
<g id="node4" class="node">
<title>trans</title>
<polygon fill="none" stroke="#000000" points="211.5,-909 124.3598,-891 211.5,-873 298.6402,-891 211.5,-909"/>
<text text-anchor="middle" x="211.5" y="-887.3" font-family="Lato" font-size="14.00" fill="#000000">transaction?</text>
</g>
<!-- hookPost&#45;&gt;trans -->
<g id="edge3" class="edge">
<title>hookPost&#45;&gt;trans</title>
<path fill="none" stroke="#000000" d="M211.5,-945.9432C211.5,-937.8174 211.5,-928.1682 211.5,-919.2408"/>
<polygon fill="#000000" stroke="#000000" points="215.0001,-919.2268 211.5,-909.2269 208.0001,-919.2269 215.0001,-919.2268"/>
</g>
<!-- schedule -->
<g id="node5" class="node">
<title>schedule</title>
<polygon fill="none" stroke="#000000" points="251.5,-822 21.5,-822 21.5,-786 251.5,-786 251.5,-822"/>
<text text-anchor="middle" x="136.5" y="-800.3" font-family="Lato" font-size="14.00" fill="#000000">schedule callback for post commit</text>
</g>
<!-- trans&#45;&gt;schedule -->
<g id="edge4" class="edge">
<title>trans&#45;&gt;schedule</title>
<path fill="none" stroke="#000000" d="M198.0915,-875.4461C187.213,-862.8271 171.6438,-844.7668 158.881,-829.962"/>
<polygon fill="#000000" stroke="#000000" points="161.3073,-827.416 152.1269,-822.1272 156.0054,-831.9866 161.3073,-827.416"/>
<text text-anchor="middle" x="189.5" y="-843.8" font-family="Lato" font-size="14.00" fill="#000000">yes</text>
</g>
<!-- runCallback -->
<g id="node6" class="node">
<title>runCallback</title>
<polygon fill="none" stroke="#000000" points="258.5,-749 164.5,-749 164.5,-713 258.5,-713 258.5,-749"/>
<text text-anchor="middle" x="211.5" y="-727.3" font-family="Lato" font-size="14.00" fill="#000000">runCallback</text>
</g>
<!-- trans&#45;&gt;runCallback -->
<g id="edge5" class="edge">
<title>trans&#45;&gt;runCallback</title>
<path fill="none" stroke="#000000" d="M226.5384,-875.8449C238.3399,-862.8093 253.8478,-842.8566 260.5,-822 265.3619,-806.7566 266.1945,-800.9523 260.5,-786 256.3532,-775.1115 248.9516,-765.0069 241.1372,-756.5074"/>
<polygon fill="#000000" stroke="#000000" points="243.434,-753.8513 233.9262,-749.1766 238.4436,-758.7601 243.434,-753.8513"/>
<text text-anchor="middle" x="273" y="-800.3" font-family="Lato" font-size="14.00" fill="#000000">no</text>
</g>
<!-- schedule&#45;&gt;runCallback -->
<g id="edge6" class="edge">
<title>schedule&#45;&gt;runCallback</title>
<path fill="none" stroke="#000000" d="M155.0393,-785.9551C164.2342,-777.0054 175.4928,-766.047 185.5305,-756.2769"/>
<polygon fill="#000000" stroke="#000000" points="188.1892,-758.5734 192.914,-749.0904 183.3068,-753.5572 188.1892,-758.5734"/>
</g>
<!-- setGiftAidEligibilityStatus -->
<g id="node7" class="node">
<title>setGiftAidEligibilityStatus</title>
<polygon fill="none" stroke="#000000" points="301.5,-676 121.5,-676 121.5,-640 301.5,-640 301.5,-676"/>
<text text-anchor="middle" x="211.5" y="-654.3" font-family="Lato" font-size="14.00" fill="#000000">setGiftAidEligibilityStatus</text>
</g>
<!-- runCallback&#45;&gt;setGiftAidEligibilityStatus -->
<g id="edge7" class="edge">
<title>runCallback&#45;&gt;setGiftAidEligibilityStatus</title>
<path fill="none" stroke="#000000" d="M211.5,-712.9551C211.5,-704.8828 211.5,-695.1764 211.5,-686.1817"/>
<polygon fill="#000000" stroke="#000000" points="215.0001,-686.0903 211.5,-676.0904 208.0001,-686.0904 215.0001,-686.0903"/>
</g>
<!-- qAlreadySet -->
<g id="node8" class="node">
<title>qAlreadySet</title>
<polygon fill="none" stroke="#000000" points="211.5,-603 35.5,-565 211.5,-527 387.5,-565 211.5,-603"/>
<text text-anchor="middle" x="211.5" y="-568.8" font-family="Lato" font-size="14.00" fill="#000000">contrib eligibility already</text>
<text text-anchor="middle" x="211.5" y="-553.8" font-family="Lato" font-size="14.00" fill="#000000">set to yes or no?</text>
</g>
<!-- setGiftAidEligibilityStatus&#45;&gt;qAlreadySet -->
<g id="edge8" class="edge">
<title>setGiftAidEligibilityStatus&#45;&gt;qAlreadySet</title>
<path fill="none" stroke="#000000" d="M211.5,-639.6262C211.5,-632.0068 211.5,-622.7735 211.5,-613.4359"/>
<polygon fill="#000000" stroke="#000000" points="215.0001,-613.3342 211.5,-603.3342 208.0001,-613.3342 215.0001,-613.3342"/>
</g>
<!-- calcContribElig -->
<g id="node9" class="node">
<title>calcContribElig</title>
<polygon fill="none" stroke="#000000" points="257,-476 0,-476 0,-440 257,-440 257,-476"/>
<text text-anchor="middle" x="128.5" y="-454.3" font-family="Lato" font-size="14.00" fill="#000000">calculate eligibility from financial type</text>
</g>
<!-- qAlreadySet&#45;&gt;calcContribElig -->
<g id="edge9" class="edge">
<title>qAlreadySet&#45;&gt;calcContribElig</title>
<path fill="none" stroke="#000000" d="M186.1463,-532.3151C174.1907,-516.9024 160.117,-498.7592 148.8684,-484.258"/>
<polygon fill="#000000" stroke="#000000" points="151.5039,-481.9452 142.6092,-476.189 145.9729,-486.2357 151.5039,-481.9452"/>
<text text-anchor="middle" x="178" y="-497.8" font-family="Lato" font-size="14.00" fill="#000000">No</text>
</g>
<!-- updateGiftAidFields -->
<g id="node10" class="node">
<title>updateGiftAidFields</title>
<polygon fill="none" stroke="#000000" points="399,-403 22,-403 22,-365 399,-365 399,-403"/>
<text text-anchor="middle" x="210.5" y="-387.8" font-family="Lato" font-size="14.00" fill="#000000">CRM_Civigiftaid_Utils_Contribution::updateGiftAidFields</text>
<text text-anchor="middle" x="210.5" y="-372.8" font-family="Lato" font-size="14.00" fill="#000000">(logic shown below applies only to this use case)</text>
</g>
<!-- qAlreadySet&#45;&gt;updateGiftAidFields -->
<g id="edge11" class="edge">
<title>qAlreadySet&#45;&gt;updateGiftAidFields</title>
<path fill="none" stroke="#000000" d="M240.2745,-533.0323C259.2957,-507.863 278.5195,-471.8367 265.5,-440 260.9121,-428.7812 252.8729,-418.5981 244.3344,-410.0852"/>
<polygon fill="#000000" stroke="#000000" points="246.481,-407.3017 236.7766,-403.0501 241.7116,-412.4255 246.481,-407.3017"/>
<text text-anchor="middle" x="281.5" y="-454.3" font-family="Lato" font-size="14.00" fill="#000000">Yes</text>
</g>
<!-- calcContribElig&#45;&gt;updateGiftAidFields -->
<g id="edge10" class="edge">
<title>calcContribElig&#45;&gt;updateGiftAidFields</title>
<path fill="none" stroke="#000000" d="M148.7697,-439.7079C158.6923,-430.7533 170.8132,-419.815 181.6789,-410.0093"/>
<polygon fill="#000000" stroke="#000000" points="184.2406,-412.412 189.3197,-403.114 179.5508,-407.2153 184.2406,-412.412"/>
</g>
<!-- setBatch -->
<g id="node11" class="node">
<title>setBatch</title>
<polygon fill="none" stroke="#000000" points="375.5,-328 45.5,-328 45.5,-292 375.5,-292 375.5,-328"/>
<text text-anchor="middle" x="210.5" y="-306.3" font-family="Lato" font-size="14.00" fill="#000000">Set batch to &#39;&#39; if new contrib and part of recurring.</text>
</g>
<!-- updateGiftAidFields&#45;&gt;setBatch -->
<g id="edge12" class="edge">
<title>updateGiftAidFields&#45;&gt;setBatch</title>
<path fill="none" stroke="#000000" d="M210.5,-364.9432C210.5,-356.8174 210.5,-347.1682 210.5,-338.2408"/>
<polygon fill="#000000" stroke="#000000" points="214.0001,-338.2268 210.5,-328.2269 207.0001,-338.2269 214.0001,-338.2268"/>
</g>
<!-- setContribEl -->
<g id="node12" class="node">
<title>setContribEl</title>
<polygon fill="none" stroke="#000000" points="339.5,-255 81.5,-255 81.5,-219 339.5,-219 339.5,-255"/>
<text text-anchor="middle" x="210.5" y="-233.3" font-family="Lato" font-size="14.00" fill="#000000">Set contribution&#39;s Eligible_for_Gift_Aid</text>
</g>
<!-- setBatch&#45;&gt;setContribEl -->
<g id="edge13" class="edge">
<title>setBatch&#45;&gt;setContribEl</title>
<path fill="none" stroke="#000000" d="M210.5,-291.9551C210.5,-283.8828 210.5,-274.1764 210.5,-265.1817"/>
<polygon fill="#000000" stroke="#000000" points="214.0001,-265.0903 210.5,-255.0904 207.0001,-265.0904 214.0001,-265.0903"/>
</g>
<!-- setContribAmounts -->
<g id="node13" class="node">
<title>setContribAmounts</title>
<polygon fill="none" stroke="#000000" points="378,-182 43,-182 43,-146 378,-146 378,-182"/>
<text text-anchor="middle" x="210.5" y="-160.3" font-family="Lato" font-size="14.00" fill="#000000">Set contribution&#39;s GA amount and gift_aid_amount</text>
</g>
<!-- setContribEl&#45;&gt;setContribAmounts -->
<g id="edge14" class="edge">
<title>setContribEl&#45;&gt;setContribAmounts</title>
<path fill="none" stroke="#000000" d="M210.5,-218.9551C210.5,-210.8828 210.5,-201.1764 210.5,-192.1817"/>
<polygon fill="#000000" stroke="#000000" points="214.0001,-192.0903 210.5,-182.0904 207.0001,-192.0904 214.0001,-192.0903"/>
</g>
<!-- saveContribGA -->
<g id="node14" class="node">
<title>saveContribGA</title>
<polygon fill="none" stroke="#000000" points="328.5,-109 92.5,-109 92.5,-73 328.5,-73 328.5,-109"/>
<text text-anchor="middle" x="210.5" y="-87.3" font-family="Lato" font-size="14.00" fill="#000000">Save with CustomValue.create API</text>
</g>
<!-- setContribAmounts&#45;&gt;saveContribGA -->
<g id="edge15" class="edge">
<title>setContribAmounts&#45;&gt;saveContribGA</title>
<path fill="none" stroke="#000000" d="M210.5,-145.9551C210.5,-137.8828 210.5,-128.1764 210.5,-119.1817"/>
<polygon fill="#000000" stroke="#000000" points="214.0001,-119.0903 210.5,-109.0904 207.0001,-119.0904 214.0001,-119.0903"/>
</g>
<!-- end -->
<g id="node15" class="node">
<title>end</title>
<polygon fill="none" stroke="#000000" points="237.5,-36 183.5,-36 183.5,0 237.5,0 237.5,-36"/>
<text text-anchor="middle" x="210.5" y="-14.3" font-family="Lato" font-size="14.00" fill="#000000">Done</text>
</g>
<!-- saveContribGA&#45;&gt;end -->
<g id="edge16" class="edge">
<title>saveContribGA&#45;&gt;end</title>
<path fill="none" stroke="#000000" d="M210.5,-72.9551C210.5,-64.8828 210.5,-55.1764 210.5,-46.1817"/>
<polygon fill="#000000" stroke="#000000" points="214.0001,-46.0903 210.5,-36.0904 207.0001,-46.0904 214.0001,-46.0903"/>
</g>
</g>
</svg>
